# NVIDIA GPU Metrics Logger

## 專案簡介

一個基於 Python 的 NVIDIA GPU 監測系統，能夠持續監控所有 NVIDIA GPU 的使用狀況並記錄至 CSV 檔案，適用於深度學習訓練過程監控、系統效能分析等場景。

## 功能特色

- 🔄 **即時監控**: 可自定義時間間隔持續監控 GPU 狀態
- 📊 **完整指標**: 記錄 GPU 使用率、記憶體使用量、溫度、功耗等關鍵指標
- 💾 **資料持久化**: 自動將監控資料寫入 CSV 檔案，包含完整時間戳記
- 🖥️ **多 GPU 支援**: 自動偵測並監控系統中所有 NVIDIA GPU
- ⚡ **輕量化設計**: 最小化系統資源占用

## 技術棧

- **Python 3.8+**
- **nvidia-ml-py3**: NVIDIA 管理庫 Python 綁定
- **pandas**: 資料處理與 CSV 操作
- **datetime**: 時間戳記處理
- **configparser**: 設定檔管理

## 系統需求

### 硬體需求
- NVIDIA GPU（支援 CUDA）
- NVIDIA 驅動程式已安裝

### 軟體需求
- Python 3.8 或更高版本
- NVIDIA Driver 440.33+ 或更新版本

## 安裝與配置

### 1. 套件安裝
```
pip install nvidia-ml-py3 pandas
```

### 2. 環境檢查
確認 NVIDIA 驅動與 CUDA 工具包已正確安裝：
```
nvidia-smi
```

### 3. 設定檔案
創建 `config.ini` 設定監控參數：
```
[MONITORING]
interval_seconds = 5
output_directory = ./logs
csv_filename_prefix = gpu_metrics
max_file_size_mb = 100

[GPU_METRICS]
include_utilization = true
include_memory = true
include_temperature = true
include_power = true
include_fan_speed = true
```

## 系統架構

### 核心模組

#### 1. GPU 監控器 (`gpu_monitor.py`)
- **GPUMonitor 類別**
  - 初始化 NVIDIA ML 庫
  - 偵測可用 GPU 數量
  - 定期收集 GPU 指標

#### 2. 資料記錄器 (`data_logger.py`)
- **DataLogger 類別**
  - CSV 檔案管理
  - 資料格式化與寫入
  - 檔案輪替機制

#### 3. 主控程式 (`main.py`)
- **MainController 類別**
  - 監控流程控制
  - 設定檔讀取
  - 錯誤處理與重啟機制

#### 4. 工具函數 (`utils.py`)
- 時間格式化工具
- 檔案管理工具
- 設定驗證工具

## 資料格式

### CSV 輸出格式
| 欄位名稱 | 資料型別 | 說明 | 單位 |
|---------|---------|------|------|
| timestamp | datetime | 記錄時間 | YYYY-MM-DD HH:MM:SS |
| gpu_id | int | GPU 編號 | - |
| gpu_name | string | GPU 型號名稱 | - |
| utilization_gpu | float | GPU 使用率 | % |
| utilization_memory | float | 記憶體使用率 | % |
| memory_total | int | 總記憶體 | MB |
| memory_used | int | 已使用記憶體 | MB |
| memory_free | int | 可用記憶體 | MB |
| temperature | int | GPU 溫度 | °C |
| power_draw | float | 功耗 | W |
| power_limit | float | 功耗限制 | W |
| fan_speed | int | 風扇轉速 | % |

### 檔案命名規則
```
gpu_metrics_data.csv
```

## 使用方式

### 基本使用
```
python main.py
```

### 指定設定檔
```
python main.py --config custom_config.ini
```

### 背景執行
```
nohup python main.py > monitor.log 2>&1 &
```

### 停止監控
```
# 使用 Ctrl+C 或發送 SIGINT 訊號
kill -INT <process_id>
```

## 專案結構

```
nvidia-gpu-metrics-logger/
├── src/
│   ├── gpu_monitor.py          # GPU 監控核心
│   ├── data_logger.py          # 資料記錄器
│   ├── utils.py                # 工具函數
│   └── main.py                 # 主程式
├── config/
│   └── config.ini              # 預設設定檔
├── logs/                       # CSV 輸出目錄
├── tests/                      # 單元測試
├── requirements.txt            # Python 套件依賴
├── README.md                   # 專案說明
└── setup.py                    # 安裝腳本
```

## 錯誤處理機制

### 1. GPU 偵測失敗
- 自動重試機制
- 錯誤日誌記錄

### 2. 檔案寫入錯誤
- 目錄權限檢查
- 磁碟空間監控
- 錯誤日誌記錄

### 3. 記憶體不足
- 資料批次寫入
- 緩存大小限制
- 自動清理機制
- 錯誤日誌記錄

## 效能優化

### 1. 記憶體使用
- 使用生成器處理大量資料
- 定期清理無用物件
- 控制緩存大小

### 2. CPU 使用率
- 優化監控頻率
- 異步資料寫入
- 多執行緒處理